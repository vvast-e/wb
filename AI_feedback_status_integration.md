# Интеграция AI-оценки отзывов в API

## Задача

Добавить в endpoint отзывов по товарам поле `ai_status`, которое вычисляется с помощью AI (например, OpenAI GPT).
AI должен определять статус отзыва:
- **"позитив"** — если звёзды и текст совпадают по тону (оба положительные)
- **"негатив"** — если звёзды и текст совпадают по тону (оба отрицательные)
- **"спорно"** — если звёзды и текст противоречат друг другу

---

## Пример промта для AI

```
Оцени отзыв о товаре.
Количество звёзд: 2
Текст отзыва: "Очень понравился товар, всё отлично!"
Ответь одним словом: "позитив", "негатив" или "спорно".
Если количество звёзд и текст совпадают по тону — "позитив" или "негатив".
Если есть расхождение — "спорно".
```

---

## Как реализовать

1. **Создать функцию для обращения к AI**
    - Использовать OpenAI API или другой AI-сервис.
    - Передавать в промт количество звёзд и текст отзыва.
    - Получать ответ: `"позитив"`, `"негатив"` или `"спорно"`.

2. **Добавить поле `ai_status` в выдачу отзывов**
    - В функции формирования ответа API (например, в `crud/product_reviews.py`).
    - Для каждого отзыва вызывать функцию AI-оценки и добавлять результат в json.

3. **(Опционально) Кэшировать результат**
    - Чтобы не делать повторные запросы к AI для одного и того же отзыва, можно сохранять результат в базе (например, поле `ai_status` в таблице отзывов).

---

## Пример кода (Python, OpenAI)

```python
import openai

async def get_ai_status(stars: int, text: str) -> str:
    prompt = (
        f"Оцени отзыв о товаре.\n"
        f"Количество звёзд: {stars}\n"
        f"Текст отзыва: \"{text}\"\n"
        f"Ответь одним словом: \"позитив\", \"негатив\" или \"спорно\".\n"
        f"Если количество звёзд и текст совпадают по тону — \"позитив\" или \"негатив\".\n"
        f"Если есть расхождение — \"спорно\"."
    )
    response = openai.ChatCompletion.create(
        model="gpt-3.5-turbo",
        messages=[{"role": "user", "content": prompt}],
        max_tokens=1,
        temperature=0
    )
    return response.choices[0].message['content'].strip().lower()
```

---

## Пример выдачи API

```json
{
  "id": 123,
  "author": "Иван",
  "rating": 2,
  "text": "Очень понравился товар, всё отлично!",
  "is_deleted": false,
  "ai_status": "спорно"
}
```

---

## Рекомендации

- Для массовой обработки отзывов используйте асинхронные запросы к AI.
- Не забывайте про лимиты и стоимость использования AI API.
- Для ускорения работы и экономии — кэшируйте результат AI-оценки.

---

Если нужно — могу реализовать интеграцию под ваш ключ OpenAI или другой сервис, а также добавить кэширование результата в базу!
Дайте знать, если хотите увидеть готовую функцию или пример интеграции в ваш проект. 